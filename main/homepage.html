<!doctypehtml><html lang=en><meta charset=UTF-8><meta content=width=1024 name=viewport><title>WiCAN</title><style>:root{--primary-color:#24478f;--primary-light:#c2d1f0;--primary-dark:#1a3266;--background-color:#f0f2f5;--white:#fff;--gray-100:#f7f7f7;--gray-200:#e9ecef;--gray-300:#dee2e6;--gray-400:#ced4da;--gray-500:#adb5bd;--gray-600:#6c757d;--gray-700:#495057;--shadow-sm:0 1px 3px #0000001f;--shadow-md:0 4px 6px #0000001a;--transition:all .3s ease}body{background-color:var(--background-color);color:var(--gray-700);margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;line-height:1.5;display:flex;overflow-x:hidden}.sidebar{background-color:var(--white);border-right:1px solid var(--gray-200);box-shadow:var(--shadow-sm);width:240px;height:100vh;padding-top:1rem;position:fixed;overflow-y:auto}.sidebar button{cursor:pointer;text-align:left;transition:var(--transition);color:var(--gray-600);background-color:#0000;border:none;outline:none;align-items:center;gap:.75rem;width:100%;padding:1rem 1.5rem;font-size:.95rem;display:flex}.sidebar button:hover{background-color:var(--gray-100);color:var(--primary-color)}.sidebar button.active{background-color:var(--primary-color);color:var(--white);font-weight:500}.logo{width:80%;max-width:100%;height:auto;max-height:100%;margin:2.5rem auto 0;padding:0;display:block}.content{width:calc(100% - 240px);max-width:1200px;margin-left:240px;padding:2rem}.tabcontent{background-color:var(--white);box-shadow:var(--shadow-md);border-radius:8px;margin-bottom:1.5rem;padding:1.5rem;display:none}.form-table{border-collapse:separate;border-spacing:0 .5rem;width:100%;font-weight:600}.form-table td{vertical-align:middle;padding:.75rem}.form-table td:first-child{color:var(--gray-700);width:40%;font-weight:500}.slider-container{align-items:center;gap:10px;display:flex}input[type=range]{width:100%}input,input[type=number],select{border:1px solid var(--gray-300);transition:var(--transition);background-color:var(--white);border-radius:6px;width:100%;padding:.65rem;font-size:.95rem}input:focus,input[type=number]:focus,select:focus{border-color:var(--primary-color);outline:none;box-shadow:0 0 0 3px #24478f1a}input:disabled,input[type=number]:disabled,select:disabled{background-color:var(--gray-100);cursor:not-allowed}button,input[type=button],.store{background-color:var(--primary-color);color:var(--white);cursor:pointer;transition:var(--transition);border:none;border-radius:6px;width:auto;padding:.65rem 1.25rem;font-weight:500}button:hover,input[type=button]:hover,.store:hover{background-color:var(--primary-dark)}button:disabled,input[type=button]:disabled,.store:disabled{background-color:var(--gray-400);cursor:not-allowed}.section-title{color:var(--primary-color);border-bottom:2px solid var(--primary-light);margin:0 0 1rem;padding-bottom:.5rem;font-size:1.5rem;font-weight:600}.divider{border-bottom:1px solid var(--gray-200);margin:1.5rem 0}#table2{border-collapse:separate;border-spacing:0;width:100%;margin:1rem 0}#table2 th,#table2 td{border:1px solid var(--gray-300);padding:.75rem}#table2 th{background-color:var(--gray-100);text-align:left;font-weight:600}#table2 tr:nth-child(2n){background-color:var(--gray-50)}.status-indicator{border-radius:1rem;align-items:center;padding:.25rem .75rem;font-size:.875rem;font-weight:500;display:inline-flex}.status-connected{color:#065f46;background-color:#d1fae5}.status-disconnected{color:#991b1b;background-color:#fee2e2}input[type=file]{border:1px dashed var(--gray-400);background-color:var(--gray-50);cursor:pointer;border-radius:6px;padding:.5rem}input[type=file]:hover{border-color:var(--primary-color)}input[type=checkbox]{cursor:pointer;width:1.25rem;height:1.25rem;margin-right:.5rem}.notification-container{z-index:1000;padding:1rem;font-weight:500;transition:all .3s;display:none;position:fixed;top:0;left:240px;right:0}.notification-container.show{display:block}.form-input::placeholder{color:#888;font-size:14px}.custom-init-group{margin-bottom:1.5rem}.custom-init-group label{color:var(--gray-700);margin-bottom:.5rem;display:block}.pid-entry{background:var(--white);color:var(--gray-600);border:none;border-radius:8px;margin-bottom:.2rem;padding:0;font-size:.95rem;font-weight:500}.pid-header{justify-content:space-between;align-items:center;margin-bottom:2rem;display:flex}.pid-title{color:var(--gray-700)}.pid-content{flex-direction:column;gap:1.5rem;display:flex}.pid-field{flex-direction:column;gap:.5rem;display:flex}.pid-field label{color:var(--gray-700)}.pid-field input,.pid-field select{border:1px solid var(--gray-300);border-radius:6px;width:50%;padding:.75rem}.button-group{gap:1rem;margin-top:1rem;display:flex}@media (width<=768px){.notification-container{left:0}}@media (width<=1024px){.sidebar{width:200px}.content{width:calc(100% - 200px);margin-left:200px}}.system-button{white-space:nowrap;width:auto;min-width:110px;margin:.1rem;padding:.65rem 1.25rem}@media (width<=768px){.system-button{width:100%;min-width:110px;margin:.1rem 0}.sidebar{width:100%;height:auto;position:relative}.content{width:100%;margin-left:0;padding:1rem}.form-table td{width:100%;display:block}.form-table td:first-child{padding-bottom:.25rem}.compact-form-table{border-collapse:collapse;width:100%}.compact-form-table td{vertical-align:middle;padding:3px;font-size:.85rem}.compact-form-table input,.compact-form-table select{border:1px solid var(--gray-300);border-radius:4px;width:95%;height:24px;padding:2px 5px;font-size:.85rem}}</style></head><body onload=Load();><div class=sidebar><embed class=logo src=/logo.svg><button onclick="openTab(event, 'status_view')"class=tablinks id=defaultOpen><b>Status</b></button><button onclick="openTab(event, 'wifi_settings')"class=tablinks><b>Settings</b></button><button onclick="openTab(event, 'automate')"class=tablinks><b>Automate</b></button><button onclick="openTab(event, 'monitor')"class=tablinks><b>Monitor</b></button><button onclick="openTab(event, 'power_saving_tab')"class=tablinks><b>Power Saving</b></button><button onclick="openTab(event, 'system_tab')"class=tablinks><b>System</b></button><button onclick="openTab(event, 'about_tab')"class=tablinks><b>About</b></button></div><div class=content><div class=notification-container id=notification></div><div class=tabcontent id=status_view><div class=section-title>Status</div><table class=form-table><tr><td>WiFi Mode:</td><td><div id=wifi_mode_current>AP </div></td></tr><tr><td>AP Channel:</td><td><div id=ap_channel_status>6 </div></td></tr><tr><td>WiFi Station:</td><td><div id=sta_status>Not Connected </div></td></tr><tr><td>Station IP:</td><td><div id=sta_ip>192.168.3.1 </div></td></tr><tr><td>mDNS:</td><td><div id=mdns> </div></td></tr><tr><td>CAN Bitrate:</td><td><div id=can_bitrate_status>500K </div></td></tr><tr><td>CAN Mode:</td><td><div id=can_mode_status>Silent </div></td></tr><tr><td>Port Type:</td><td><div id=port_type_status>TCP </div></td></tr><tr><td>TCP/UDP Port:</td><td><div id=port_status>3333 </div></td></tr><tr><td>Battery Voltage:</td><td><div id=batt_voltage>12.8V </div></td></tr><tr><td><input value="Check status"id=check_status_button name=check_status_button onclick=checkStatus() type=button></td><td> </td></tr></table></div><div class=tabcontent id=wifi_settings><form action=/action_page id=configForm name=configForm onchange=submit_enable();><div class=section-title>AP Config</div><table class=form-table><tr><td>Mode:</td><td><select id=wifi_mode name=wifi_mode><option value=AP>AP</option><option value=APStation>AP+Station</option></select></td></tr><tr><td>AP Channel:</td><td><select id=ap_ch_value name=ap_ch_value><option value=1>1</option><option value=2>2</option><option value=3>3</option><option value=4>4</option><option value=5>5</option><option value=6>6</option><option value=7>7</option><option value=8>8</option><option value=9>9</option><option value=10>10</option><option value=11>11</option><option value=12>12</option><option value=13>13</option><option value=14>14</option></select></td></tr><tr><td>AP Password:</td><td><input id=ap_pass_value name=ap_pass_value value=Testpass></td></tr><tr><td>Auto-Disable AP:</td><td><select id=ap_auto_disable name=ap_auto_disable onchange=submit_enable();><option value=enable>Enable</option><option value=disable>Disable</option></select></td></tr></table><div class=divider></div><div class=section-title>Station Config</div><table class=form-table><tr><td>SSID:</td><td><input disabled id=ssid_value name=ssid_value value=MeatPi></td></tr><tr><td>Password:</td><td><input disabled id=pass_value name=pass_value value=TomatoSauce></td></tr><tr><td>Security:</td><td><select disabled id=sta_security name=sta_security><option value=wpa3>WPA3</option><option value=wpa2>WPA2</option></select></td></tr></table><div class=divider></div><div class=section-title>CAN</div><table class=form-table><tr><td>CAN Bitrate:</td><td><select id=can_datarate name=can_datarate><option value=5K>5K</option><option value=10K>10K</option><option value=20K>20K</option><option value=25K>25K</option><option value=50K>50K</option><option value=100K>100K</option><option value=125K>125K</option><option value=250K>250K</option><option value=500K>500K</option><option value=800K>800K</option><option value=1000K>1000K</option></select></td></tr><tr><td>CAN Mode:</td><td><select id=can_mode name=can_mode><option selected value=normal>Normal</option><option value=silent>Silent</option></select></td></tr><tr><td>Port Type:</td><td><select id=port_type name=port_type><option value=tcp>TCP</option><option value=udp>UDP</option></select></td></tr><tr><td>TCP/UDP Port:</td><td><input id=tcp_port_value max=65535 min=1 name=tcp_port_value type=number value=3333></td></tr><tr><td>Protocol:</td><td><select id=protocol name=protocol><option value=realdash66>realdash66</option><option value=slcan>slcan</option><option value=savvycan>savvyCAN</option><option value=elm327>elm327</option><option value=auto_pid>AutoPID</option></select></td></tr><tr><td>MQTT:</td><td><select id=mqtt_en name=mqtt_en><option value=enable>Enable</option><option value=disable>Disable</option></select></td></tr></table><div class=divider></div><div class=section-title>BLE</div><table class=form-table><tr><td>Passkey:</td><td><input id=ble_pass_value max=999999 min=0 name=ble_pass_value type=number value=000000></td></tr><tr><td>BLE Status:</td><td><select id=ble_status name=ble_status><option value=enable>Enable</option><option value=disable>Disable</option></select></td></tr></table><div id=mqtt_en_div><div class=divider></div><div class=section-title>MQTT</div><table class=form-table><tr><td><label for=mqtt_url><b>MQTT URL:</b></label></td><td><input id=mqtt_url name=mqtt_url value=127.0.0.1></td></tr><tr><td><label for=mqtt_port><b>MQTT Port:</b></label></td><td><input id=mqtt_port max=65535 min=1 name=mqtt_port type=number value=1883></td></tr><tr><td><label for=mqtt_user><b>MQTT User:</b></label></td><td><input id=mqtt_user name=mqtt_user value=meatpi></td></tr><tr><td><label for=mqtt_pass><b>MQTT Pass:</b></label></td><td><input id=mqtt_pass name=mqtt_pass value=meatpi></td></tr><tr><td><label for=keep_alive><b>Keep Alive:</b></label></td><td class=slider-container><input oninput="document.getElementById('keep_alive_value').textContent = this.value;submit_enable();"id=keep_alive max=120 min=2 name=keep_alive step=1 type=range value=30> <span id=keep_alive_value>30</span>seconds</td></tr><tr><td><label for=mqtt_tx_topic><b>TX Topic:</b></label></td><td><input id=mqtt_tx_topic name=mqtt_tx_topic></td><td><input id=mqtt_tx_en_checkbox name=mqtt_tx_en_checkbox onchange=txCheckBoxChanged() type=checkbox></td></tr><tr><td><label for=mqtt_rx_topic><b>RX Topic:</b></label></td><td><input id=mqtt_rx_topic name=mqtt_rx_topic></td><td><input id=mqtt_rx_en_checkbox name=mqtt_rx_en_checkbox onchange=rxCheckBoxChanged() type=checkbox></td></tr><tr><td><label for=mqtt_status_topic><b>Status Topic:</b></label></td><td><input id=mqtt_status_topic name=mqtt_status_topic></td></tr><tr><td><label for=mqtt_elm327_log><b>MQTT elm327 log:</b></label></td><td><select id=mqtt_elm327_log name=mqtt_elm327_log onchange=alert_elm327() style=width:93px><option value=enable>Enable</option><option value=disable>Disable</option></select></td></tr><tr><td> </td><td> </td></tr></table><div style=overflow-x:auto><div class=section-title>MQTT CAN Filter</div><table id=can_flt_table><tr><th style=text-align:left>CAN ID (dec)</th><th style=text-align:left>Name</th><th style=text-align:left>PID</th><th style=text-align:left>Index</th><th style=text-align:left>Start Bit</th><th style=text-align:left>Bit Length</th><th style=text-align:left>Expression</th><th style=text-align:left>Cycle ms</th><th><input id=store_canflt_button name=store_canflt_button onclick=storeCANFLT() style=width:100% type=button value=Store></th></tr><tr><td style=width:10%><input id=canId max=536870912 min=0 style=width:80% type=number></td><td style=width:20%><input id=name maxlength=16 style=width:90%></td><td style=width:10%><input id=pid style=width:80% type=number></td><td style=width:10%><input id=pindex style=width:80% type=number></td><td style=width:10%><input id=startBit max=63 min=0 style=width:80% type=number></td><td style=width:10%><input id=bitLength max=64 min=1 style=width:80% type=number></td><td style=width:20%><input id=expression maxlength=64 style=width:90%></td><td style=width:10%><input id=cycle max=1000 min=100 style=width:80% type=number></td><td><input value="Add ID"id=add_row_button name=add_row_button onclick=addCANFLTRow() style=width:100% type=button></td></tr></table></div></div></form></div><div class=tabcontent id=automate><div class=section-title>Automate</div><table class=form-table><tr><td>MQTT HA Discovery:</td><td><select enableautostorebutton();submit_enable();" id=ha_discovery name=ha_discovery toggledestinationandcycle(); togglesendtofields();><option value=disable>Disable</option></select></td></tr><tr><td>Grouping:</td><td><select enableautostorebutton();submit_enable();" id=grouping name=grouping toggledestinationandcycle(); togglesendtofields();><option value=disable>Disable</option><option value=enable>Enable</option></select></td></tr><tr><td>Destination Type:</td><td><select id=group_dest_type name=group_dest_type onchange=enableAutoStoreButton();submit_enable();><option value=Default>Default</option><option value=MQTT_Topic>MQTT Topic</option></select></td></tr><tr><td>Destination:</td><td><input disabled id=destination name=destination oninput=enableAutoStoreButton();submit_enable();></td></tr><tr><td>Cycle Time(ms):</td><td><input disabled id=group_cycle name=group_cycle oninput=enableAutoStoreButton();submit_enable(); value=5000></td></tr></table><div class=section-title>Standard PIDs</div><table class=form-table><tr><td>Standard PIDs:</td><td><select id=standard_pids name=standard_pids onchange=toggleStandardPIDOptions();enableAutoStoreButton();submit_enable();><option value=disable>Disable</option><option value=enable>Enable</option></select></td></tr><tr><td>ECU Protocol:</td><td><select id=ecu_protocol name=ecu_protocol onchange=enableAutoStoreButton();submit_enable();><option value=6>6- ISO 15765-4 (CAN 11bit/500K)</option><option value=7>7- ISO 15765-4 (CAN 29bit/500K)</option><option value=8>8- ISO 15765-4 (CAN 11bit/250K)</option><option value=9>9- ISO 15765-4 (CAN 29bit/250K)</option></select></td></tr><tr><td>Available PIDs:</td><td style=align-items:center;gap:5px;display:flex><select disabled id=available_pids name=available_pids onchange=enableAutoStoreButton();submit_enable(); style=flex:1></select> <button disabled id=add_pid_button onclick=addSelectedPID() style=margin-left:5px>Add PID</button> <button id=scan_pids_button onclick=scanAvailablePIDs() style=margin-left:5px>Scan PIDs</button></td></tr></table><div id=standard_pids_table><div class=std-pid-entries></div></div><div class=section-title>Vehicle Specific</div><table class=form-table><tr><td>Vehicle Specific:</td><td><select onchange="toggleCarModel(); toggleDestinationAndCycle(); enableAutoStoreButton();submit_enable();"id=car_specific name=car_specific><option value=disable>Disable</option><option value=enable>Enable</option></select></td></tr><tr><td>Vehicle Model:</td><td style=align-items:center;gap:5px;display:flex><select id=car_model name=car_model onchange=enableAutoStoreButton();submit_enable(); style=flex:1></select> <button onclick=fetchVehicleProfiles() style=margin-left:5px>Get Latest</button></td></tr><tr><td>Vehicle Profiles:</td><td><form enctype=multipart/form-data id=car_data_form><input id=car_data_file name=car_data_file onchange=sendCARDataFile();submit_enable(); type=file></form></td></tr><tr><td>Specific Initialisation:</td><td><input id=specific_init name=specific_init oninput=enableAutoStoreButton()></td></tr></table><div id=specific_pids_table><div class=specific-pid-entries></div></div><div class=section-title>Custom PIDs</div><table class=form-table><tr><td>Custom Initialisation:</td><td><input id=initialisation name=initialisation oninput=enableAutoStoreButton()></td></tr></table><div id=automate_table><div class=pid-entries></div></div><div class=button-group><button class=primary-button onclick=addRowAutoTable()>New</button><button class=store disabled id=custom_pid_store onclick=storeAutoTableData()>Store</button></div></div><div class=tabcontent id=monitor><div class=section-title>Monitor Settings</div><table class=form-table><tr><td>Bitrate</td><td>Filter</td><td>Mask</td></tr><tr><td><select id=mon_datarate name=mon_datarate><option value=10K>10K</option><option value=20K>20K</option><option value=50K>50K</option><option value=100K>100K</option><option value=125K>125K</option><option value=250K>250K</option><option selected value=500K>500K</option><option value=800K>800K</option><option value=1000K>1Mbit</option></select></td><td><input id=mon_filter name=mon_filter value=00000000></td><td><input id=mon_mask name=mon_mask value=FFFFFFFF></td><td><input id=mon_button name=mon_button onclick=mon_control() style=font-size:100% type=button value=Start></td></tr></table><div class=divider></div><table class=form-table id=table2><thead><tr><th>ID</th><th>Type</th><th>Len</th><th>Data</th><th>Time</th><th>Count</th></tr></thead><tbody></tbody></table></div><div class=tabcontent id=power_saving_tab><div class=section-title>Sleep Mode</div><table class=form-table><tr><td>Sleep Mode:</td><td><select id=sleep_status name=sleep_status onchange=submit_enable();><option value=enable>Enable</option><option value=disable>Disable</option></select></td></tr><tr><td>Sleep Voltage:</td><td class=slider-container><input oninput="document.getElementById('sleep_volt_value').textContent = this.value;submit_enable();"id=sleep_volt max=15.0 min=12.0 name=sleep_volt step=0.1 type=range value=13.2> <span id=sleep_volt_value>13.2</span>V</td></tr><tr><td>Sleep After:</td><td class=slider-container><input oninput="document.getElementById('sleep_time_value').textContent = this.value;submit_enable();"id=sleep_time max=30 min=1 name=sleep_time step=1 type=range value=2> <span id=sleep_time_value>2</span>min</td></tr><tr><td>Battery Alert:</td><td><select id=batt_alert name=batt_alert onchange=submit_enable();><option value=enable>Enable</option><option value=disable>Disable</option></select></td></tr></table><div id=batt_alert_div><div class=divider></div><div class=section-title>Battery Alert</div><table class=form-table><tr><td><label for=batt_alert_ssid><b>SSID:</b></label></td><td><input id=batt_alert_ssid name=batt_alert_ssid value=MeatPi></td></tr><tr><td><label for=batt_alert_pass><b>Password:</b></label></td><td><input id=batt_alert_pass name=batt_alert_pass value=TomatoSauce></td></tr><tr><td><label for=batt_alert_volt><b>Alert Voltage:</b></label></td><td><input id=batt_alert_volt max=15.0 min=9.0 name=batt_alert_volt step=0.1 type=number value=11.0></td></tr><tr><td><label for=batt_alert_protocol><b>Alert Protocol:</b></label></td><td><select id=batt_alert_protocol name=batt_alert_protocol style=width:93px><option value=mqtt>MQTT</option></select></td></tr><tr><td><label for=batt_alert_url><b>Alert URL:</b></label></td><td><input id=batt_alert_url name=batt_alert_url value=127.0.0.1></td></tr><tr><td><label for=batt_alert_port><b>Alert Port:</b></label></td><td><input id=batt_alert_port max=65535 min=1 name=batt_alert_port type=number value=1883></td></tr><tr><td><label for=batt_mqttusername><b>Alert MQTT User:</b></label></td><td><input id=batt_mqtt_user name=batt_mqtt_user value=meatpi></td></tr><tr><td><label for=batt_mqttpass><b>Alert MQTT Pass:</b></label></td><td><input id=batt_mqtt_pass name=batt_mqtt_pass value=meatpi></td></tr><tr><td><label for=batt_alert_topic><b>Alert Topic:</b></label></td><td><input id=batt_alert_topic name=batt_alert_topic value=CAR1/voltage></td></tr><tr><td><b>Alert every:</b></td><td><select id=batt_alert_time name=batt_alert_time style=width:93px><option value=1>1hr</option><option value=6>6hr</option><option value=12>12hr</option><option value=24>1day</option></select></td></tr><tr><td> </td><td> </td></tr></table></div></div><div class=tabcontent id=system_tab><div class=section-title>System</div><table class=form-table><tr><td>Reboot WiCAN:</td><td><input class=system-button id=reboot_button name=reboot_button onclick=reboot() type=button value=Reboot></td></tr><tr><td>Download Configuration:</td><td><input class=system-button id=download_cfg_butt name=download_cfg_butt onclick=downloadCfg() type=button value=Download></td></tr><tr><td>Upload Configuration:</td><td><input class=system-button onclick=document.getElementById('fileInput').click() type=button value=Upload> <input accept=.json id=fileInput onchange=uploadCfg() style=display:none type=file></td></tr></table><div class=section-title>Firmware Update</div><form action=/upload/ota.bin enctype=multipart/form-data id=ota_form method=post><table class=form-table><tr><td><input accept=.bin id=ota_file name=ota_file type=file></td><td><input class=system-button id=ota_submit_button onclick=otaClick() type=button value=Update></td></tr></table></form></div><div class=tabcontent id=about_tab><div class=section-title>About</div><table class=form-table><tr><td>Firmware ver:</td><td><div id=fw_version>1.00</div></td></tr><tr><td>Hardware ver:</td><td><div id=hw_version>v2.10</div></td></tr><tr><td>Git ver:</td><td><div id=git_version>v2.10</div></td></tr><tr><td>Designed By:</td><td><div id=made_by><a href=https://www.meatpi.com/><b>meatpi.com</b></a></div></td></tr></table></div><input value="Submit Changes"disabled id=submit_button name=submit_button onclick=postConfig() type=button></div><script>var addCANFLTRow=(()=>{let F=64,E=0,H=1,v=`startBit`,x=`cycle`,w=`bitLength`,D=``,G=100,y=`name`,u=`canId`,I=7,A=`pid`,B=`pindex`,z=`expression`,C=isNaN,t=parseInt;var a=t(document.getElementById(u).value);var b=t(document.getElementById(v).value);var c=t(document.getElementById(w).value);Length=t(document.getElementById(w).value);var d=t(document.getElementById(x).value);var e=document.getElementById(y).value;var f=document.getElementById(z).value;var g=t(document.getElementById(A).value);var h=t(document.getElementById(B).value);if(C(a)||a==D||a<E||a>536870912){alert(`CAN ID must be a valid number between 0 and 536870912`);return};if(C(b)||C(c)||b>F- c||c<=E||c>F||b<E||b>63){alert(`startBit or bitLength error`);return};if(C(d)||d<G||d>10000){alert(`cycle must be between 100 and 10000`);return};if(e.length<H||e.length>16){alert(`Name must be between 1 and 16 characters in length.`);return};if(f.length<H||f.length>F){alert(`Expression must be between 1 and 64 characters in length.`);return};if(C(g)||g<-H||g>255){alert(`PID must be a number between -1 and 255`);return};if(C(h)||h<E||h>I){alert(`PID must be a number between 0 and 7`);return};if(isNameUnique(e)){var i=document.getElementById(`can_flt_table`);var j=i.insertRow(-H);var k=j.insertCell(E);var l=j.insertCell(H);var m=j.insertCell(2);var n=j.insertCell(3);var o=j.insertCell(4);var p=j.insertCell(5);var q=j.insertCell(6);var r=j.insertCell(I);var s=j.insertCell(8);if(i.rows.length- H>=G){alert(`Maximum row limit (100) reached.`);return};k.innerHTML=a;l.innerHTML=e;m.innerHTML=g;n.innerHTML=h;o.innerHTML=b;p.innerHTML=c;q.innerHTML=f;r.innerHTML=d;s.innerHTML=`<button style="width: 100%;" onclick="deleteCANFLTRow(this) ">Delete</button>`;canData.push({CANID:a,Name:e,PID:g,PIDIndex:h,StartBit:b,BitLength:c,Expression:f,Cycle:d});document.getElementById(u).value=D;document.getElementById(y).value=D;document.getElementById(A).value=D;document.getElementById(B).value=D;document.getElementById(v).value=D;document.getElementById(w).value=D;document.getElementById(z).value=D;document.getElementById(x).value=D}else{alert(`Name must be unique.`)};document.getElementById(`store_canflt_button`).disabled=!1});var fetchVehicleProfiles=(async()=>{let b=Error;try{if(!navigator.onLine){throw new b(`No internet connection`)};const c=await fetch(`https://raw.githubusercontent.com/meatpiHQ/wican-fw/main/vehicle_profiles.json`);if(!c.ok){throw new b(`Network response was not ok`)};const d=await c.json();console.log(d);latest_car_models=d;const e=[];e.push(`Not Selected`);if(d&&Array.isArray(d.cars)){d.cars.forEach(a=>{if(a.car_model){e.push(a.car_model)}})};console.log(e);var a={"supported":e};loadCarModels(a);enableAutoStoreButton()}catch(a){console.error(`There was a problem with the fetch operation:`,a);showNotification(`Unable to fetch vehicle_profiles.json. `+ a.message,`red`)}});var bindEvents=(()=>{let e=``,i=`h`,a=0,j=9,g=1,h=3,d=2,f=` `,k=8,c=`0`,b=4;ws.onmessage=(l=>{var m=l.data;if(m[a]==`t`){var n=(m[b]- c)*d;var o=e;var p;for(p=a;p<n;p+=d){o+=m.substr(p+ 5,d)+ f};monitor_add_line(m.substr(g,h)+ i,`Std`,m[b],o,a)}else if(m[a]==`T`){var n=(m[j]- c)*d;var o=e;var p;for(p=a;p<n;p+=d){o+=m.substr(p+ 10,d)+ f};monitor_add_line(m.substr(g,k)+ i,`Ext`,m[j],o,a)}else if(m[a]==`r`){var n=(m[b]- c)*d;monitor_add_line(m.substr(g,h)+ i,`RTR-Std`,m[b],a,a)}else if(m[a]==`R`){var n=(m[j]- c)*d;monitor_add_line(m.substr(g,k)+ i,`RTR-Ext`,m[j],a,a)}})});var toggleDiscovery=(()=>{const a=document.getElementById(`car_specific`).value;const b=document.getElementById(`ha_discovery`);b.disabled=!0;b.value=`disable`});var monitor_add_line=((a,b,c,d,e)=>{let r=0,w=5,q=1,t=3,s=2,u=4,v=Date.now;var f=document.getElementById(`table2`);var g=-q;if(typeof monitor_add_line.msg_time==`undefined`){monitor_add_line.msg_time=[r]};for(var h=q,i=f.rows.length;h<i;h++){if(f.rows[h].cells[r].innerHTML==a){g=h;break}};if(g!=-q){f.rows[g].cells[r].innerHTML=a;f.rows[g].cells[q].innerHTML=b;f.rows[g].cells[s].innerHTML=c;f.rows[g].cells[t].innerHTML=d;f.rows[g].cells[u].innerHTML=v()- monitor_add_line.msg_time[g];f.rows[g].cells[w].innerHTML=++f.rows[g].cells[w].innerHTML;monitor_add_line.msg_time[g]=v()}else{var j=f.insertRow(q);var k=j.insertCell(r);var l=j.insertCell(q);var m=j.insertCell(s);var n=j.insertCell(t);var o=j.insertCell(u);var p=j.insertCell(w);k.innerHTML=a;l.innerHTML=b;m.innerHTML=c;n.innerHTML=d;o.innerHTML=r;p.innerHTML=q;k.style.width=`10%`;monitor_add_line.msg_time.push(v())}});var otaClick=(()=>{let a=`No files selected!`;if(document.getElementById(`ota_file`).files.length==0){showNotification(a,`red`);alert(a)}else{document.getElementById(`ota_submit_button`).disabled=!0;showNotification(`Updating please wait...`,`green`);setTimeout((()=>{document.getElementById(`ota_form`).submit()}),5000)}});var loadautoPID=(()=>{console.log(`Loading auto PID data...`);const a=new XMLHttpRequest();a.onload=function(){console.log(`Server response:`,this.responseText);if(this.responseText!==`NONE`){const a=JSON.parse(this.responseText);loadAutoTable(a);document.getElementById(`custom_pid_store`).disabled=!0}else{console.log(`No PID data found on server`)}};a.onerror=(a=>{console.error(`Error loading auto PID:`,a)});a.open(`GET`,`/load_auto_pid`);a.send()});var storeAutoTableData=(async()=>{let s=`Name must not be empty and must be less than 32 characters`,d=0,g=`.name-input`,j=`.type-select`,k=`.send-to-input`,h=`.expression-input`,i=`.period-input`,a=``,m=`application/json`,r=32,q=`red`,b=`disable`,t=64,f=`.pid-input`,p=1000,c=`Default`,u=`Send_to must be less than 64 characters`,l=`POST`,e=Error,n=JSON.stringify,o=parseInt;try{const v=[];const w=[];const x=document.querySelectorAll(`.pid-entry`);const y=document.querySelectorAll(`.std-pid-entry`);const z=document.getElementById(`initialisation`)?.value||a;const A=document.getElementById(`grouping`)?.value||b;const B=document.getElementById(`group_dest_type`)?.value||c;const C=document.getElementById(`ha_discovery`)?.value||b;const D=document.getElementById(`destination`)?.value||a;const E=document.getElementById(`group_cycle`);const F=E?.value||`5000`;const G=document.getElementById(`car_specific`)?.value||b;const H=document.getElementById(`car_model`);const I=document.getElementById(`standard_pids`)?.value||b;const J=document.getElementById(`ecu_protocol`)?.value||`6`;const K=H?.value||a;if(G==`enable`&&(!K||K.length===d||K===`Not Selected`)){throw new e(`Car model must be selected`)};let L={car_model:K,init:document.getElementById(`specific_init`).value,pids:[]};const M=document.querySelectorAll(`.specific-pid-entry`);if(M.length>d){L.pids=Array.from(M).map(a=>({pid:a.querySelector(f).value,pid_init:a.querySelector(`.pid-init-input`).value,parameters:[{name:a.querySelector(g).value,expression:a.querySelector(h).value,unit:a.querySelector(`.unit-input`).value,class:a.querySelector(`.class-input`).value,period:a.querySelector(i).value,min:a.querySelector(`.min-input`).value,max:a.querySelector(`.max-input`).value,type:a.querySelector(j).value,send_to:a.querySelector(k).value}]}))};fetch(`/store_car_data`,{method:l,headers:{'Content-Type':m},body:n({cars:[L]})}).then(a=>a.text()).then(a=>console.log(`Success:`,a)).catch(a=>console.error(`Error:`,a));if(!E.disabled&&(!/^\d+$/.test(F)||o(F)<p)){showNotification(`Cycle must be a number greater than 1000`,q);return !1};if(x?.length){x.forEach((b,l)=>{const m={Name:b.querySelector(g)?.value||a,Init:b.querySelector(`.init-input`)?.value||a,PID:b.querySelector(f)?.value||a,Expression:b.querySelector(h)?.value||a,MinValue:b.querySelector(`.min-value-input`)?.value||a,MaxValue:b.querySelector(`.max-value-input`)?.value||a,Period:b.querySelector(i)?.value||a,Type:b.querySelector(j)?.value||c,Send_to:b.querySelector(k)?.value||a};if(m.Name.length===d||m.Name.length>=r){throw new e(s)};if(m.PID.length===d||m.PID.length>=10){throw new e(`PID must not be empty and must be less than 10 characters`)};if(m.Expression.length===d||m.Expression.length>=t){throw new e(`Expression must not be empty and must be less than 64 characters`)};if(!/^\d+$/.test(m.Period)||o(m.Period)<100&&o(m.Period)!=d){throw new e(`Period must be a number greater than 100`)};if(m.Send_to.length>=t){throw new e(u)};v.push(m)})};if(y?.length){y.forEach((b,f)=>{const h={Name:b.querySelector(g)?.value||a,ReceiveHeader:b.querySelector(`.receive-header-input`)?.value||a,Period:b.querySelector(i)?.value||a,Type:b.querySelector(j)?.value||c,Send_to:b.querySelector(k)?.value||a};if(h.Name.length===d||h.Name.length>=r){throw new e(s)};if(!/^\d+$/.test(h.Period)||o(h.Period)<p&&o(h.Period)!=d){throw new e(`Period must be a number greater than 1000`)};if(h.Send_to.length>=t){throw new e(u)};w.push(h)})};const N={initialisation:z,grouping:A,group_dest_type:B,destination:D,cycle:F,car_specific:G,ha_discovery:C,car_model:K,pids:v,std_pids:w,standard_pids:I,ecu_protocol:J};await fetch(`store_auto_data`,{method:l,headers:{'Content-Type':m},body:n(N)}).then(a=>a.text()).then(a=>{showNotification(`Settings saved successfully`,`green`);document.querySelector(`.store`).disabled=!0;document.getElementById(`custom_pid_store`).disabled=!0}).catch(a=>{showNotification(`Error saving settings: `+ a.message,q);return !1});return !0}catch(a){showNotification(a.message,q);return !1}});var addSelectedPID=((a={})=>{let d=``,f=`click`,g=`none`,e=`selected`;const b=document.getElementById(`available_pids`);const c=a.Name||b.value;if(c){const b=document.querySelector(`.std-pid-entries`);const h=document.createElement(`div`);h.className=`std-pid-entry`;h.innerHTML=`
            <div class="pid-header">
                <div class="header-left">
                    <button type="button" class="collapse-btn">▼</button>
                    <span class="pid-title">${c}</span>
                </div>
                <div class="header-right">
                    <button type="button" class="delete-btn">Delete</button>
                </div>
            </div>
            <div class="pid-content" style="display: none;">
                <table class="compact-form-table">
                    <tr>
                        <td>Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                        <td><input type="text" class="name-input" value="${c}" readonly></td>
                    </tr>
                    <tr>
                        <td>Receive Header:</td>
                        <td><input type="text" class="receive-header-input" value="${a.ReceiveHeader||d}" 
                            placeholder="Optional Receive Header" maxlength="8"></td>
                    </tr>
                    <tr>
                        <td>Period(ms):</td>
                        <td><input type="number" class="period-input" value="${a.Period||`1000`}" 
                            min="100" max="120000"></td>
                    </tr>
                    <tr>
                        <td>Destination Type:</td>
                        <td><select class="type-select">
                            <option value="Default" ${a.Type===`Default`?e:d}>Default</option>
                            <option value="MQTT_Topic" ${a.Type===`MQTT_Topic`?e:d}>MQTT_Topic</option>
                            <option value="MQTT_WallBox" ${a.Type===`MQTT_WallBox`?e:d}>MQTT_WallBox</option>
                        </select></td>
                    </tr>
                    <tr>
                        <td>Destination:</td>
                        <td><input type="text" class="send-to-input" value="${a.Send_to||d}" 
                            placeholder="Enter destination"></td>
                    </tr>
                </table>
            </div>
        `;const i=document.createElement(`style`);i.textContent=pidEntryStyles;document.head.appendChild(i);const j=h.querySelector(`.pid-header`);const k=h.querySelector(`.delete-btn`);const l=h.querySelector(`.collapse-btn`);const m=h.querySelector(`.pid-content`);k.addEventListener(f,()=>{h.remove();enableAutoStoreButton()});const n=a=>{a.stopPropagation();const b=m.style.display===g;m.style.display=b?`block`:g;l.textContent=b?`▲`:`▼`};j.addEventListener(f,n);l.addEventListener(f,n);h.querySelectorAll(`input, select`).forEach(a=>{a.addEventListener(`input`,enableAutoStoreButton)});b.appendChild(h);enableAutoStoreButton()}});var rxCheckBoxChanged=(()=>{let a=`mqtt_rx_topic`;if(document.getElementById(`mqtt_rx_en_checkbox`).checked){document.getElementById(a).disabled=!1}else{document.getElementById(a).disabled=!0}});var sendCARDataFile=(()=>{let d=0,f=`red`,e=`No files selected!`,g=`File size exceeds 200KB!`,c=`car_data_file`,h=JSON;const a=document.getElementById(c);const b=200*1024;if(a.files.length==d){showNotification(e,f);alert(e)}else{const e=a.files[d];if(e.size>b){showNotification(g,f);alert(g);return};const i=new FileReader();i.onload=(a=>{try{const b=h.parse(a.target.result);const d=b.car_model?{cars:[b]}:b;const e=h.stringify(d).replace(/\s+/g,``);const f=document.getElementById(`car_data_form`);const g=new FormData(f);g.set(c,new Blob([e],{type:`application/json`}));latest_car_models=null;fetch(`/upload/car_data.json`,{method:`POST`,body:g}).then(a=>a.text()).then(a=>{console.log(`Success:`,a);showNotification(a,`green`);setTimeout(()=>{window.location.reload()},1000)}).catch(a=>{console.error(`Error:`,a)})}catch(a){showNotification(`Invalid JSON file!`,f);alert(`The selected file is not a valid JSON file!`)}});i.readAsText(e)}});var submit_enable=(()=>{let k=`batt_alert`,s=32,D=`port_type`,q=`submit_button`,p=`red`,j=`none`,r=1,y=`Port value, min=1 max=65535`,z=`batt_alert_port`,F=`enable`,h=`disable`,i=`mqtt_en_div`,n=8,u=`mqtt_rx_topic`,f=`0`,x=65535,E=`sleep_status`,H=`mqtt_elm327_log`,B=`sleep_volt`,t=`mqtt_tx_topic`,c=`sta_security`,A=`ble_pass_value`,C=`protocol`,m=`ap_pass_value`,a=`ssid_value`,o=63,g=`mqtt_en`,v=`mqtt_status_topic`,G=`block`,b=`pass_value`,l=`batt_alert_div`,e=`1`,d=`ble_status`,w=`tcp_port_value`;console.log(`sumbit_enable`);if(document.getElementById(`wifi_mode`).value==`AP`){document.getElementById(a).disabled=!0;document.getElementById(b).disabled=!0;document.getElementById(c).disabled=!0;document.getElementById(d).disabled=!1;document.getElementById(`ap_auto_disable`).disabled=!0}else{document.getElementById(a).disabled=!1;document.getElementById(b).disabled=!1;document.getElementById(c).disabled=!1;document.getElementById(d).disabled=!0;document.getElementById(d).selectedIndex=e};if(document.getElementById(d).selectedIndex==f){alert(`Warrning!\\\\r\\\\n\\\\r\\\\nWhen BLE is connected the WiFi AP WiCAN_xxxxxx will be disabled.\\\\r\\\\nTo re-ennable the WiFi AP Turn OFF BLE on your phone or device, then power cycle WiCAN. If you connect to WiFi AP ssid WiCAN_xxxxxx, the BLE will automatically be disabled.`);document.getElementById(g).value=h;document.getElementById(i).style.display=j;document.getElementById(g).disabled=!0;document.getElementById(k).value=h;document.getElementById(l).style.display=j;document.getElementById(k).disabled=!0}else{document.getElementById(g).disabled=!1;document.getElementById(k).disabled=!1};if(document.getElementById(m).value.length<n||document.getElementById(m).value.length>o||document.getElementById(b).value.length<n||document.getElementById(b).value.length>o){showNotification(`AP/Station password len, min=0 max=64`,p);document.getElementById(q).disabled=!0}else if(document.getElementById(a).value.length<r||document.getElementById(a).value.length>s){showNotification(`AP/station ssid len, min=1 max=32`,p);document.getElementById(q).disabled=!0}else if(document.getElementById(t).value.length<r||document.getElementById(t).value.length>s){showNotification(`MQTT TX Topic length, min=1 max=64`,p);document.getElementById(q).disabled=!0}else if(document.getElementById(u).value.length<r||document.getElementById(u).value.length>s){showNotification(`MQTT RX Topic length, min=1 max=64`,p);document.getElementById(q).disabled=!0}else if(document.getElementById(v).value.length<r||document.getElementById(v).value.length>s){showNotification(`MQTT Status Topic length, min=1 max=64`,p);document.getElementById(q).disabled=!0}else if(document.getElementById(w).value>x||document.getElementById(w).value<r){showNotification(y,p);document.getElementById(q).disabled=!0}else if(document.getElementById(z).value>x||document.getElementById(z).value<r){showNotification(y,p);document.getElementById(q).disabled=!0}else if(document.getElementById(A).value.length!=6||document.getElementById(A).value.charAt(0)==f){showNotification(`Passkey length, min=6 max=6, 1st number not 0`,p);document.getElementById(q).disabled=!0}else if(document.getElementById(B).value<12||document.getElementById(B).value>15){showNotification(`Sleep Voltage Value, min=12.0 max=15.0`,p);document.getElementById(q).disabled=!0}else{document.getElementById(q).disabled=!1};if(document.getElementById(C).value==`savvycan`){document.getElementById(w).value=`23`;document.getElementById(w).disabled=!0;document.getElementById(D).selectedIndex=f;document.getElementById(D).disabled=!0}else{document.getElementById(w).disabled=!1;document.getElementById(D).selectedIndex=f;document.getElementById(D).disabled=!1};if(document.getElementById(E).value==F){if(document.getElementById(d).selectedIndex!=f){document.getElementById(k).disabled=!1}}else if(document.getElementById(E).value==h){document.getElementById(k).disabled=!0;document.getElementById(k).selectedIndex=e};if(document.getElementById(k).value==F){document.getElementById(l).style.display=G}else if(document.getElementById(k).value==h){document.getElementById(l).style.display=j};if(document.getElementById(g).value==F){document.getElementById(i).style.display=G}else if(document.getElementById(g).value==h){document.getElementById(i).style.display=j};if(document.getElementById(C).value==`elm327`){document.getElementById(H).disabled=!1}else{document.getElementById(H).disabled=!0;document.getElementById(H).value=h}});var isNameUnique=(a=>canData.every(b=>b[`Name`]!==a));var mon_button_en=(a=>{let b=`mon_button`,c=`mon_datarate`,d=`mon_filter`,e=`mon_mask`;if(a==1){document.getElementById(b).value=`Start`;document.getElementById(c).disabled=!1;document.getElementById(d).disabled=!1;document.getElementById(e).disabled=!1}else{document.getElementById(b).value=`Stop`;document.getElementById(c).disabled=!0;document.getElementById(d).disabled=!0;document.getElementById(e).disabled=!0}});var restoreCANFLTRow=((a,b,c,d,e,f,g,h)=>{let E=``,B=0,C=536870912,D=1;var i=a;if(i<B){i=B}else if(i>C){i=C};var j=b;var k=c;var l=d;var m=e;var n=f;var o=g;var p=h;var q=document.getElementById(`can_flt_table`);var r=q.insertRow(-D);var s=r.insertCell(B);var t=r.insertCell(D);var u=r.insertCell(2);var v=r.insertCell(3);var w=r.insertCell(4);var x=r.insertCell(5);var y=r.insertCell(6);var z=r.insertCell(7);var A=r.insertCell(8);s.innerHTML=i;t.innerHTML=j;u.innerHTML=k;v.innerHTML=l;w.innerHTML=m;x.innerHTML=n;y.innerHTML=o;z.innerHTML=p;A.innerHTML=`<button style="width: 100%;" onclick="deleteCANFLTRow(this)">Delete</button>`;canData.push({CANID:i,Name:j,PID:k,PIDIndex:l,StartBit:m,BitLength:n,Expression:o,Cycle:p});document.getElementById(`canId`).value=E;document.getElementById(`name`).value=E;document.getElementById(`pid`).value=E;document.getElementById(`pindex`).value=E;document.getElementById(`startBit`).value=E;document.getElementById(`bitLength`).value=E;document.getElementById(`expression`).value=E;document.getElementById(`cycle`).value=E});var postCANFLT=(()=>{var a={};a[`can_flt`]=canData;var b=JSON.stringify(a);const c=new XMLHttpRequest();c.onload=function(){showNotification(this.responseText,`green`);submit_enable()};c.open(`POST`,`/store_canflt`);c.send(b)});var Load=(()=>{let j=`can_datarate`,y=`batt_alert`,u=`mqtt_rx_en_checkbox`,E=`none`,v=`mqtt_rx_topic`,l=`3`,n=`can_mode`,r=`sleep_status`,t=`mqtt_tx_topic`,w=`protocol`,z=7,A=`mqtt_en`,D=`block`,e=`pass_value`,k=`2`,g=`ap_auto_disable`,s=`mqtt_tx_en_checkbox`,C=`batt_alert_div`,o=`port_type`,i=`enable`,q=`disable`,F=`mqtt_en_div`,h=`0`,B=`batt_alert_time`,f=`sta_security`,d=`ssid_value`,c=`1`,p=`ble_status`,x=`tcp_port_value`,m=`6`,b=`wifi_mode`;const a=new XMLHttpRequest();a.onload=function(){var a=JSON.parse(this.responseText);if(a.wifi_mode==`APStation`){document.getElementById(b).selectedIndex=c;document.getElementById(d).disabled=!1;document.getElementById(e).disabled=!1;document.getElementById(f).disabled=!1;document.getElementById(g).disabled=!1}else if(a.wifi_mode==`AP`){document.getElementById(b).selectedIndex=h;document.getElementById(d).disabled=!0;document.getElementById(e).disabled=!0;document.getElementById(g).disabled=!0};if(a.ap_auto_disable==i){document.getElementById(g).selectedIndex=h}else{document.getElementById(g).selectedIndex=c};var G=parseInt(a.ap_ch);G=G- 1;document.getElementById(`ap_ch_value`).selectedIndex=G.toString();document.getElementById(d).value=a.sta_ssid;document.getElementById(e).value=a.sta_pass;document.getElementById(f).value=a.sta_security||`wpa3`;if(a.can_datarate==`5K`){document.getElementById(j).selectedIndex=h}else if(a.can_datarate==`10K`){document.getElementById(j).selectedIndex=c}else if(a.can_datarate==`20K`){document.getElementById(j).selectedIndex=k}else if(a.can_datarate==`25K`){document.getElementById(j).selectedIndex=l}else if(a.can_datarate==`50K`){document.getElementById(j).selectedIndex=`4`}else if(a.can_datarate==`100K`){document.getElementById(j).selectedIndex=`5`}else if(a.can_datarate==`125K`){document.getElementById(j).selectedIndex=m}else if(a.can_datarate==`250K`){document.getElementById(j).selectedIndex=`7`}else if(a.can_datarate==`500K`){document.getElementById(j).selectedIndex=`8`}else if(a.can_datarate==`800K`){document.getElementById(j).selectedIndex=`9`}else if(a.can_datarate==`1000K`){document.getElementById(j).selectedIndex=`10`}else if(a.can_datarate==`auto`){document.getElementById(j).selectedIndex=`11`};if(a.can_mode==`normal`){document.getElementById(n).selectedIndex=h}else if(a.can_mode==`silent`){document.getElementById(n).selectedIndex=c};if(a.port_type==`tcp`){document.getElementById(o).selectedIndex=h}else if(a.port_type==`udp`){document.getElementById(o).selectedIndex=c};if(a.ble_status==i){document.getElementById(p).selectedIndex=h}else if(a.ble_status==q){document.getElementById(p).selectedIndex=c};if(a.sleep_status==i){document.getElementById(r).selectedIndex=h}else if(a.sleep_status==q){document.getElementById(r).selectedIndex=c};if(`mqtt_tx_en` in a){if(a.mqtt_tx_en===i){document.getElementById(s).checked=!0}else{document.getElementById(s).checked=!1}}else{document.getElementById(s).checked=!1;document.getElementById(t).disabled=!0};if(`mqtt_rx_en` in a){if(a.mqtt_rx_en===i){document.getElementById(u).checked=!0}else{document.getElementById(u).checked=!1}}else{document.getElementById(u).checked=!1;document.getElementById(v).disabled=!0};txCheckBoxChanged();rxCheckBoxChanged();document.getElementById(w).value=a.protocol;document.getElementById(x).value=a.port;document.getElementById(`ap_pass_value`).value=a.ap_pass;document.getElementById(`ble_pass_value`).value=a.ble_pass;document.getElementById(`sleep_volt`).value=a.sleep_volt;document.getElementById(`sleep_volt_value`).textContent=a.sleep_volt;document.getElementById(`sleep_time`).value=a.sleep_time;document.getElementById(`sleep_time_value`).textContent=a.sleep_time;document.getElementById(y).value=a.batt_alert;document.getElementById(`batt_alert_ssid`).value=a.batt_alert_ssid;document.getElementById(`batt_alert_pass`).value=a.batt_alert_pass;document.getElementById(`batt_alert_volt`).value=a.batt_alert_volt;document.getElementById(`batt_alert_protocol`).value=a.batt_alert_protocol;document.getElementById(`batt_alert_url`).value=a.batt_alert_url.slice(z);document.getElementById(`batt_alert_port`).value=a.batt_alert_port;document.getElementById(`batt_alert_topic`).value=a.batt_alert_topic;document.getElementById(`batt_mqtt_user`).value=a.batt_mqtt_user;document.getElementById(`batt_mqtt_pass`).value=a.batt_mqtt_pass;document.getElementById(A).value=a.mqtt_en;document.getElementById(`mqtt_url`).value=a.mqtt_url.slice(z);document.getElementById(`mqtt_port`).value=a.mqtt_port;document.getElementById(`mqtt_user`).value=a.mqtt_user;document.getElementById(`mqtt_pass`).value=a.mqtt_pass;document.getElementById(`keep_alive_value`).textContent=a.keep_alive_value;document.getElementById(`keep_alive`).value=a.keep_alive;document.getElementById(t).value=a.mqtt_tx_topic;document.getElementById(v).value=a.mqtt_rx_topic;document.getElementById(`mqtt_status_topic`).value=a.mqtt_status_topic;document.getElementById(`mqtt_elm327_log`).value=a.mqtt_elm327_log;if(a.batt_alert_time==c){document.getElementById(B).selectedIndex=h}else if(a.batt_alert_time==m){document.getElementById(B).selectedIndex=c}else if(a.batt_alert_time==`12`){document.getElementById(B).selectedIndex=k}else if(a.batt_alert_time==`24`){document.getElementById(B).selectedIndex=l};if(document.getElementById(w).value==`savvycan`){document.getElementById(x).value=`23`;document.getElementById(x).disabled=!0;document.getElementById(o).selectedIndex=h;document.getElementById(o).disabled=!0};if(document.getElementById(y).value==i){document.getElementById(C).style.display=D}else if(document.getElementById(y).value==q){document.getElementById(C).style.display=E};if(document.getElementById(A).value==i){document.getElementById(F).style.display=D}else if(document.getElementById(A).value==q){document.getElementById(F).style.display=E};loadCANFLT();loadautoPIDCarData();loadautoPID();document.getElementById(`car_model`).addEventListener(`change`,function(){document.querySelector(`.specific-pid-entries`).innerHTML=``;const a=this.value;if(latest_car_models&&Array.isArray(latest_car_models.cars)){const b=latest_car_models.cars.find(b=>b.car_model===a);const c=document.getElementById(`specific_init`);c.value=b.init;if(b&&b.pids){b.pids.forEach(a=>{if(a.parameters){a.parameters.forEach(b=>{addCarParameter({...b,pid:a.pid,pid_init:a.pid_init})})}})}}});document.getElementById(`store_canflt_button`).disabled=!0;document.querySelector(`.store`).disabled=!0;document.getElementById(`submit_button`).disabled=!0};checkStatus();a.open(`GET`,`/load_config`);a.send()});var sta_enable=(()=>{});var openTab=((a,b)=>{let f=0,g=` active`;var c,d,e;d=document.getElementsByClassName(`tabcontent`);for(c=f;c<d.length;c++){d[c].style.display=`none`};e=document.getElementsByClassName(`tablinks`);for(c=f;c<e.length;c++){e[c].className=e[c].className.replace(g,``)};document.getElementById(b).style.display=`block`;a.currentTarget.className+=g});var toggleStandardPIDOptions=(()=>{const a=document.getElementById(`standard_pids`);const b=document.getElementById(`ecu_protocol`);const c=document.getElementById(`available_pids`);const d=document.getElementById(`scan_pids_button`);const e=a.value===`enable`;b.disabled=!e;c.disabled=!e;d.disabled=!e});var toggleSendToFields=(()=>{const a=document.getElementById(`grouping`)?.value||`disable`;const b=document.getElementById(`automate_table`);if(!b)return;const c=b.getElementsByClassName(`pid-entry`);if(!c.length)return;Array.from(c).forEach(b=>{const c=b.querySelector(`.send-to-input`);if(c){c.disabled=a===`Group ALL`}})});var addCarParameter=((a={})=>{let b=``,d=`click`,e=`none`,c=`selected`;if(a.name){const f=document.querySelector(`.specific-pid-entries`);const g=document.createElement(`div`);g.className=`specific-pid-entry`;g.innerHTML=`
            <div class="pid-header">
                <div class="header-left">
                    <button type="button" class="collapse-btn">▼</button>
                    <span class="pid-title">${a.name}</span>
                </div>
                <div class="header-right">
                    <button type="button" class="delete-btn">Delete</button>
                </div>
            </div>
            <div class="pid-content" style="display: none;">
                <table class="compact-form-table">
                    <tr>
                        <td>Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                        <td><input type="text" class="name-input" value="${a.name}"></td>
                    </tr>
                    <tr>
                        <td>PID:</td>
                        <td><input type="text" class="pid-input" value="${a.pid||b}" placeholder="PID"></td>
                    </tr>
                    <tr>
                        <td>PID Init:</td>
                        <td><input type="text" class="pid-init-input" value="${a.pid_init||b}" placeholder="Init"></td>
                    </tr>
                    <tr>
                        <td>Expression:</td>
                        <td><input type="text" class="expression-input" value="${a.expression||b}" placeholder="Expression"></td>
                    </tr>
                    <tr>
                        <td>Unit:</td>
                        <td><input type="text" class="unit-input" value="${a.unit||b}" placeholder="Unit"></td>
                    </tr>
                    <tr>
                        <td>Class:</td>
                        <td><input type="text" class="class-input" value="${a.class||b}" placeholder="Class"></td>
                    </tr>

                    <tr>
                        <td>Min Value:</td>
                        <td><input type="number" class="min-input" value="${a.min||b}" step="0.01" placeholder="Min"></td>
                    </tr>
                    <tr>
                        <td>Max Value:</td>
                        <td><input type="number" class="max-input" value="${a.max||b}" step="0.01" placeholder="Max"></td>
                    </tr>
                    <tr>
                        <td>Period(ms):</td>
                        <td><input type="number" class="period-input" value="${a.period||`5000`}" min="100" max="60000"></td>
                    </tr>
                    <tr>
                        <td>Destination Type:</td>
                        <td><select class="type-select">
                            <option value="Default" ${a.type===`Default`?c:b}>Default</option>
                            <option value="MQTT_Topic" ${a.type===`MQTT_Topic`?c:b}>MQTT_Topic</option>
                            <option value="MQTT_WallBox" ${a.type===`MQTT_WallBox`?c:b}>MQTT_WallBox</option>
                        </select></td>
                    </tr>
                    <tr>
                        <td>Destination:</td>
                        <td><input type="text" class="send-to-input" value="${a.send_to||b}" 
                            placeholder="Destination"></td>
                    </tr>
                </table>
            </div>
        `;const h=document.createElement(`style`);h.textContent=pidEntryStyles;document.head.appendChild(h);const i=g.querySelector(`.pid-header`);const j=g.querySelector(`.delete-btn`);const k=g.querySelector(`.collapse-btn`);const l=g.querySelector(`.pid-content`);j.addEventListener(d,()=>{g.remove();enableAutoStoreButton()});const m=a=>{a.stopPropagation();const b=l.style.display===e;l.style.display=b?`block`:e;k.textContent=b?`▲`:`▼`};i.addEventListener(d,m);k.addEventListener(d,m);g.querySelectorAll(`input, select`).forEach(a=>{a.addEventListener(`input`,enableAutoStoreButton)});f.appendChild(g);enableAutoStoreButton()}});var addCollapsibleRow=((a={})=>{let n=``,p=`click`,q=`none`,r=`input`,o=`selected`;const b=document.querySelector(`.pid-entries`);const c=document.createElement(`div`);c.className=`pid-entry`;c.innerHTML=`
        <div class="pid-header">
            <div class="header-left">
                <button type="button" class="collapse-btn">▼</button>
                <span class="pid-title">New PID</span>
            </div>
            <div class="header-right">
                <button type="button" class="delete-btn">Delete</button>
            </div>
        </div>
        <div class="pid-content hidden">
            <table class="compact-form-table">
                <tr>
                    <td>Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                    <td><input type="text" class="name-input" value="${a.Name||n}" 
                        placeholder="Parameter Name"></td>
                </tr>
                <tr>
                    <td>Init:</td>
                    <td><input type="text" class="init-input" value="${a.Init||n}" 
                        placeholder="PID Init"></td>
                </tr>
                <tr>
                    <td>PID:</td>
                    <td><input type="text" class="pid-input" value="${a.PID||n}" 
                        placeholder="PID"></td>
                </tr>
                <tr>
                    <td>Expression:</td>
                    <td><input type="text" class="expression-input" value="${a.Expression||n}" 
                        placeholder="Enter expression"></td>
                </tr>
                <tr>
                    <td>Min Value:</td>
                    <td><input type="number" class="min-value-input" value="${a.MinValue||n}" 
                        step="0.01" placeholder="Minimum value"></td>
                </tr>
                <tr>
                    <td>Max Value:</td>
                    <td><input type="number" class="max-value-input" value="${a.MaxValue||n}" 
                        step="0.01" placeholder="Maximum value"></td>
                </tr>
                <tr>
                    <td>Period(ms):</td>
                    <td><input type="number" class="period-input" value="${a.Period||n}" 
                        placeholder="ms"></td>
                </tr>
                <tr>
                    <td>Destination Type:</td>
                    <td><select class="type-select">
                        <option value="Default" ${a.Type===`Default`?o:n}>Default</option>
                        <option value="MQTT_Topic" ${a.Type===`MQTT_Topic`?o:n}>MQTT_Topic</option>
                        <option value="MQTT_WallBox" ${a.Type===`MQTT_WallBox`?o:n}>MQTT_WallBox</option>
                    </select></td>
                </tr>
                <tr>
                    <td>Send_to:</td>
                    <td><input type="text" class="send-to-input" value="${a.Send_to||n}"
                        placeholder="Enter destination"></td>
                </tr>
            </table>
        </div>
    `;console.log(`addCollapsibleRow:`,a);console.log(`Send_to value:`,a.Send_to);const d=document.createElement(`style`);d.textContent=pidEntryStyles;document.head.appendChild(d);const e=c.querySelector(`.pid-header`);const f=c.querySelector(`.delete-btn`);const g=c.querySelector(`.collapse-btn`);const h=c.querySelector(`.pid-content`);const i=c.querySelector(`.pid-title`);const j=c.querySelector(`.name-input`);const k=c.querySelector(`.pid-input`);f.addEventListener(p,()=>{c.remove();enableAutoStoreButton()});const l=a=>{a.stopPropagation();const b=h.style.display===q||getComputedStyle(h).display===q;h.style.display=b?`block`:q;g.textContent=b?`▲`:`▼`};e.addEventListener(p,l);g.addEventListener(p,l);i.textContent=a.Name?a.Name:`New PID`;const m=()=>{i.textContent=`${j.value||`New Parameter`}`};j.addEventListener(r,m);k.addEventListener(r,m);c.querySelectorAll(`input, select`).forEach(a=>{a.addEventListener(r,enableAutoStoreButton)});b.appendChild(c)});var loadautoPIDCarData=(()=>{const a=new XMLHttpRequest();a.onload=function(){console.log(`Car models:`,this.responseText);if(this.responseText!=`NONE`){var a=JSON.parse(this.responseText);const c=[];if(a&&Array.isArray(a.cars)){a.cars.forEach(a=>{if(a.car_model){c.push(a.car_model)};if(a.pids){document.getElementById(`specific_init`).value=a.init;a.pids.forEach(a=>{if(a.parameters){a.parameters.forEach(b=>{addCarParameter({name:b.name,expression:b.expression,unit:b.unit,class:b.class,period:b.period,type:b.type,min:b.min,max:b.max,send_to:b.send_to,pid:a.pid,pid_init:a.pid_init})})}})}})};var b={"supported":c};loadCarModels(b)}else{toggleCarModel();toggleDestinationAndCycle();toggleSendToFields();toggleStandardPIDOptions()}};a.open(`GET`,`/load_auto_pid_car_data`);a.send()});var mon_control=(()=>{var a=document.getElementById(`mon_datarate`).selectedIndex;var b=window.location.href;var c=`http://192.168.31.72/`;console.log(a);alert(`Please reboot device after Monitor, otherwise the device may not function as expected`);ws_url=`ws://`+ b.substr(7,b.length)+ `ws`;console.log(ws_url);if(document.getElementById(`mon_button`).value==`Start`){ws=new WebSocket(ws_url);setTimeout(bindEvents,1000);ws.addEventListener(`open`,b=>{var c=`C`+ cr+ `S`+ a+ cr+ `O`+ cr;console.log(`onopen called`);ws.send(c);window.mon_button_en(0)});ws.addEventListener(`close`,a=>{window.mon_button_en(1);console.log(`onclose called`)})}else{ws_close()}});var reboot=(()=>{const a=new XMLHttpRequest();document.getElementById(`reboot_button`).disabled=!0;showNotification(`Rebooting please reconnect...`,`yellow`);a.open(`POST`,`/system_reboot`);a.send(`reboot`)});var showNotification=((a,b=e,c=5000)=>{let e=`red`,f=`#fee2e2`,i=`show`,g=`#ef4444`,h=`#991b1b`;const d=document.getElementById(`notification`);switch(b){case e:d.style.backgroundColor=f;d.style.borderColor=g;d.style.color=h;break;case `green`:d.style.backgroundColor=`#dcfce7`;d.style.borderColor=`#22c55e`;d.style.color=`#166534`;break;case `blue`:d.style.backgroundColor=`#dbeafe`;d.style.borderColor=`#3b82f6`;d.style.color=`#1e40af`;break;case `yellow`:d.style.backgroundColor=`#fef9c3`;d.style.borderColor=`#eab308`;d.style.color=`#854d0e`;break;default:d.style.backgroundColor=f;d.style.borderColor=g;d.style.color=h}d.innerHTML=a;d.classList.add(i);if(window.notificationTimeout){clearTimeout(window.notificationTimeout)};window.notificationTimeout=setTimeout(()=>{d.classList.remove(i)},c)});var scanAvailablePIDs=(async()=>{let c=`red`;const a=document.querySelector(`#scan_pids_button`);const b=document.querySelector(`#add_pid_button`);try{a.disabled=!0;a.textContent=`Scanning...`;b.disabled=!0;const d=document.getElementById(`ecu_protocol`).value;const e=await fetch(`/scan_available_pids?protocol=${d}`);if(!e.ok){throw new Error(`HTTP error! status: ${e.status}`)};const f=await e.json();const g=document.getElementById(`available_pids`);g.innerHTML=``;if(f.text){showNotification(f.text,c)}else if(f.std_pids&&Array.isArray(f.std_pids)&&f.std_pids.length>0){f.std_pids.forEach(a=>{const b=document.createElement(`option`);b.value=a;b.textContent=a;g.appendChild(b)});b.disabled=!1;showNotification(`PID scan complete`,`green`)}else{showNotification(`No PIDs found. Try a different protocol or check if ignition is ON`,`orange`)}}catch(a){console.error(`Error:`,a);showNotification(`PID scan failed: `+ a.message,c)}finally{a.disabled=!1;a.textContent=`Scan PIDs`}});var addRowAutoTable=(()=>{addCollapsibleRow();enableAutoStoreButton()});var send_system_command=(a=>{const b=new XMLHttpRequest();const c={"command":a};b.open(`POST`,`/system_commands`);b.send(JSON.stringify(c))});var txCheckBoxChanged=(()=>{let a=`mqtt_tx_topic`;if(document.getElementById(`mqtt_tx_en_checkbox`).checked){document.getElementById(a).disabled=!1}else{document.getElementById(a).disabled=!0}});var loadCANFLT=(()=>{let b=`NONE`;const a=new XMLHttpRequest();a.onload=function(){if(this.responseText===b){return};var a=JSON.parse(this.responseText);if(this.responseText!=b){if(Array.isArray(a.can_flt)){a.can_flt.forEach(a=>{restoreCANFLTRow(a[`CANID`],a[`Name`],a[`PID`],a[`PIDIndex`],a[`StartBit`],a[`BitLength`],a[`Expression`],a[`Cycle`])})}}};a.open(`GET`,`/load_canflt`);a.send()});var toggleDestinationField=(()=>{const a=document.getElementById(`grouping`).value;toggleDestinationAndCycle()});var ws_close=(()=>{ws.send(`C`+ cr);ws.close()});var storeCANFLT=(()=>{postCANFLT();document.getElementById(`store_canflt_button`).disabled=!0});var loadAutoTable=(a=>{let b=``,f=`standard_pids`,k=`change`,h=`group_dest_type`,l=`function`,c=`car_specific`,d=`disable`,e=`grouping`,g=`ecu_protocol`,i=`Default`,j=Array.isArray;try{console.log(`Raw jsonData:`,a);const m=a;const n=document.getElementById(`initialisation`);if(n){n.value=m.initialisation||b};const o=document.getElementById(`automate_table`);if(!o){console.error(`Automate table not found`);return};const p=(a,c,d=b)=>{const e=document.getElementById(a);if(e){e.value=c||d}};p(c,m.car_specific,d);p(`ha_discovery`,d);p(e,m.grouping,d);p(`group_cycle`,m.cycle,`5000`);p(`destination`,m.destination,b);p(`car_model`,m.car_model,b);p(f,m.standard_pids,d);p(g,m.ecu_protocol,`6`);p(h,m.group_dest_type,i);if(m.pids&&j(m.pids)){m.pids.forEach((a,c)=>{console.log(`Loading PID ${c}:`,a);addCollapsibleRow({Name:a.Name||b,Init:a.Init||b,PID:a.PID||b,Expression:a.Expression||b,MinValue:a.MinValue||b,MaxValue:a.MaxValue||b,Period:a.Period||b,Type:a.Type||i,Send_to:a.Send_to||b})})};if(m.std_pids&&j(m.std_pids)){m.std_pids.forEach((a,c)=>{console.log(`Loading Standard PID ${c}:`,a);addSelectedPID({Name:a.Name||b,ReceiveHeader:a.ReceiveHeader||b,Period:a.Period||b,Type:a.Type||i,Send_to:a.Send_to||b})})};requestAnimationFrame(()=>{try{const a=document.getElementById(c);if(a){a.dispatchEvent(new Event(k))};const b=document.getElementById(e);if(b){b.dispatchEvent(new Event(k))};const d=document.getElementById(h);if(d){d.dispatchEvent(new Event(k))};const i=document.getElementById(g);if(i){i.dispatchEvent(new Event(k))};const j=document.getElementById(f);if(j){j.dispatchEvent(new Event(k))};if(typeof toggleCarModel===l)toggleCarModel();if(typeof toggleDestinationAndCycle===l)toggleDestinationAndCycle();if(typeof toggleSendToFields===l)toggleSendToFields();if(typeof toggleStandardPIDOptions===l)toggleStandardPIDOptions()}catch(a){console.error(`Error in UI updates:`,a)}});console.log(`loadAutoTable completed successfully`)}catch(a){console.error(`Error in loadAutoTable:`,a);showNotification(`Error loading table data: `+ a.message,`red`)}});var alert_elm327=(()=>{alert(`If elm327 log is enabled then only CAN frames proccessed by elm327 will be sent to MQTT broker.`)});var deleteCANFLTRow=(a=>{let e=1;var b=a.parentNode.parentNode;var c=b.cells[0].textContent;var d=canData.findIndex(a=>a[`CANID`]===parseInt(c));if(d!==-e){canData.splice(d,e)};b.parentNode.removeChild(b);document.getElementById(`store_canflt_button`).disabled=!1});var uploadCfg=(async()=>{let e=JSON;const a=document.getElementById(`fileInput`);const b=a.files[0];if(!b)return;const c={'config':`/store_config`,'auto_pid':`/store_auto_data`,'auto_pid_car_data':`/store_car_data`,'canflt':`/store_canflt`};const d=200;try{const f=new FileReader();f.onload=(async(b)=>{try{const f=e.parse(b.target.result);let g=!1;for(const [a,b] of Object.entries(c)){if(f[a]){try{const c=await fetch(b,{method:`POST`,headers:{'Content-Type':`application/json`},body:e.stringify(f[a])});if(!c.ok){g=!0;throw new Error(`HTTP error! status: ${c.status}`)};await new Promise(a=>setTimeout(a,d))}catch(a){g=!0}}};if(g){alert(`Some configurations failed to upload`)}else{alert(`Configuration uploaded successfully, Rebooting...`)};a.value=``}catch(a){alert(`Failed to parse configuration file`)}});f.onerror=(()=>{alert(`Error reading file`)});f.readAsText(b)}catch(a){alert(`Upload failed`)}});var enableAutoStoreButton=(()=>{const a=document.querySelector(`button.store`);if(a){a.disabled=!1};document.getElementById(`custom_pid_store`).disabled=!1});var loadCarModels=(a=>{const b=document.getElementById(`car_model`);if(a&&Array.isArray(a.supported)){b.innerHTML=``;a.supported.forEach(a=>{const c=document.createElement(`option`);c.value=a;c.text=a;b.appendChild(c)})}else{console.error(`Invalid data format or missing 'supported' property.`)};toggleCarModel();toggleDestinationAndCycle();toggleSendToFields();toggleStandardPIDOptions()});var postConfig=(async()=>{let k=`can_datarate`,s=`batt_alert`,G=`mqtt_port`,z=`batt_alert_port`,y=`batt_alert_url`,F=`mqtt_url`,P=`mqtt_rx_topic`,l=`can_mode`,p=`sleep_status`,K=`mqtt_tx_topic`,n=`protocol`,E=`mqtt_en`,J=`keep_alive`,L=`ap_auto_disable`,D=`batt_mqtt_pass`,m=`port_type`,N=`enable`,r=`sleep_time`,u=`batt_alert_pass`,O=`disable`,Q=`mqtt_rx_en`,H=`mqtt_user`,w=`batt_alert_protocol`,S=`mqtt_elm327_log`,q=`sleep_volt`,x=`mqtt://`,B=`batt_alert_time`,I=`mqtt_pass`,t=`batt_alert_ssid`,v=`batt_alert_volt`,j=`sta_security`,R=`mqtt_status_topic`,A=`batt_alert_topic`,C=`batt_mqtt_user`,M=`mqtt_tx_en`,o=`ble_status`,i=`wifi_mode`;var a={};await new Promise(a=>setTimeout(a,1000));const b=await storeAutoTableData();if(!b){return};a[i]=document.getElementById(i).value;a[`ap_ch`]=document.getElementById(`ap_ch_value`).value;a[`sta_ssid`]=document.getElementById(`ssid_value`).value;a[`sta_pass`]=document.getElementById(`pass_value`).value;a[j]=document.getElementById(j).value;a[k]=document.getElementById(k).value;a[l]=document.getElementById(l).value;a[m]=document.getElementById(m).value;a[`port`]=document.getElementById(`tcp_port_value`).value;a[`ap_pass`]=document.getElementById(`ap_pass_value`).value;a[n]=document.getElementById(n).value;a[`ble_pass`]=document.getElementById(`ble_pass_value`).value;a[o]=document.getElementById(o).value;a[p]=document.getElementById(p).value;a[q]=document.getElementById(q).value;a[r]=document.getElementById(r).value;a[s]=document.getElementById(s).value;a[t]=document.getElementById(t).value;a[u]=document.getElementById(u).value;a[v]=document.getElementById(v).value;a[w]=document.getElementById(w).value;let c=x;let d=c.concat(document.getElementById(y).value);a[y]=d;a[z]=document.getElementById(z).value;a[A]=document.getElementById(A).value;a[B]=document.getElementById(B).value;a[C]=document.getElementById(C).value;a[D]=document.getElementById(D).value;a[E]=document.getElementById(E).value;let e=x;let f=c.concat(document.getElementById(F).value);a[F]=f;a[G]=document.getElementById(G).value;a[H]=document.getElementById(H).value;a[I]=document.getElementById(I).value;a[J]=document.getElementById(J).value;a[K]=document.getElementById(K).value;a[L]=document.getElementById(L).value;if(document.getElementById(`mqtt_tx_en_checkbox`).checked){a[M]=N}else{a[M]=O};a[P]=document.getElementById(P).value;if(document.getElementById(`mqtt_rx_en_checkbox`).checked){a[Q]=N}else{a[Q]=O};a[R]=document.getElementById(R).value;a[S]=document.getElementById(S).value;var g=JSON.stringify(a);const h=new XMLHttpRequest();h.onload=function(){showNotification(this.responseText,`green`);document.getElementById(`submit_button`).disabled=!0};h.onerror=(()=>{showNotification(`Failed to save configuration`,`red`)});h.open(`POST`,`/store_config`);h.send(g)});var downloadCfg=(async()=>{let e=0,f=Error;const a=[`/load_config`,`/load_auto_pid_car_data`,`/load_auto_pid`,`/load_canflt`];const b=500;let c={};let d=!1;try{for(let g=e;g<a.length;g++){const e=a[g];try{const a=await fetch(e);if(!a.ok){throw new f(`HTTP error! status: ${a.status}`)};const b=await a.json();const d=e.replace(`/load_`,``);c[d]=b}catch(a){d=!0}if(g<a.length- 1){await new Promise(a=>setTimeout(a,b))}};if(Object.keys(c).length===e){throw new f(`No data was successfully fetched from any endpoint`)};const g=JSON.stringify(c,null,2);const h=new Blob([g],{type:`application/json`});const i=window.URL.createObjectURL(h);const j=document.createElement(`a`);j.href=i;j.download=`config_${new Date().toISOString().split(`T`)[e]}.json`;document.body.appendChild(j);j.click();document.body.removeChild(j);window.URL.revokeObjectURL(i);return !0}catch(a){alert(`Failed to download configuration`);return !1}});var toggleDestinationAndCycle=(()=>{const a=document.getElementById(`grouping`).value;const b=document.getElementById(`destination`);const c=document.getElementById(`group_cycle`);const d=document.getElementById(`group_dest_type`);if(a===`enable`){b.disabled=!1;c.disabled=!1;d.disabled=!1}else{b.disabled=!0;c.disabled=!0;d.disabled=!0}});var toggleCarModel=(()=>{const a=document.getElementById(`car_specific`).value;const b=document.getElementById(`car_model`);if(a===`disable`){b.disabled=!0}else{b.disabled=!1};toggleDiscovery()});var checkStatus=(()=>{let f=`batt_alert`,g=`enable`,k=`none`,e=`port_type_status`,j=`disable`,m=`mqtt_en_div`,c=`AP`,d=`can_mode_status`,i=`block`,l=`mqtt_en`,h=`batt_alert_div`,b=`wifi_mode_current`;const a=new XMLHttpRequest();a.onload=function(){var a=JSON.parse(this.responseText);if(a.wifi_mode==`APStation`){document.getElementById(b).innerHTML=`AP+Station`}else if(a.wifi_mode==c){document.getElementById(b).innerHTML=c};document.getElementById(`sta_status`).innerHTML=a.sta_status;document.getElementById(`ap_channel_status`).innerHTML=a.ap_ch;document.getElementById(`sta_ip`).innerHTML=a.sta_ip;document.getElementById(`mdns`).innerHTML=a.mdns;document.getElementById(`can_bitrate_status`).innerHTML=a.can_datarate;if(a.can_mode==`normal`){document.getElementById(d).innerHTML=`Normal`}else if(a.can_mode==`silent`){document.getElementById(d).innerHTML=`Silent`};if(a.port_type==`tcp`){document.getElementById(e).innerHTML=`TCP`}else if(a.port_type==`udp`){document.getElementById(e).innerHTML=`UDP`};document.getElementById(`port_status`).innerHTML=a.port;document.getElementById(`fw_version`).innerHTML=a.fw_version;document.getElementById(`hw_version`).innerHTML=a.hw_version;document.getElementById(`git_version`).innerHTML=a.git_version;document.getElementById(`protocol`).value=a.protocol;document.getElementById(`batt_voltage`).innerHTML=a.batt_voltage;if(document.getElementById(f).value==g){document.getElementById(h).style.display=i}else if(document.getElementById(f).value==j){document.getElementById(h).style.display=k};if(document.getElementById(l).value==g){document.getElementById(m).style.display=i}else if(document.getElementById(l).value==j){document.getElementById(m).style.display=k}};a.open(`GET`,`/check_status`);a.send()});document.addEventListener(`DOMContentLoaded`,a=>{document.getElementById(`submit_button`).disabled=!0});let latest_car_models=null;const pidEntryStyles=`
    .pid-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
        margin-top: 0.5rem;
        border: 2px solid var(--gray-300);
        border-radius: 8px;
    }
    
    .header-right {
        display: flex;
        gap: 0.5rem;
    }
    
    .collapse-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.2rem;
        padding: 0.25rem 0.5rem;
        color: var(--gray-700);
    }
    
    .pid-content {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        transition: height 0.3s ease;
    }
    
    .pid-content.hidden {
        display: none;
    }
`;var canData=[];document.getElementById(`defaultOpen`).click();var ws=null;var cr=String.fromCharCode(13)</script></body></html>